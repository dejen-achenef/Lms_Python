version: '3.8'

services:
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: revolutionary_lms
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

  web:
    build:
      context: .
      dockerfile: Dockerfile
    command: gunicorn lms_platform.config.wsgi:application --bind 0.0.0.0:8000
    volumes:
      - static_volume:/app/staticfiles
      - media_volume:/app/media
    ports:
      - "8000:8000"
    depends_on:
      - db
      - redis
    restart: unless-stopped
    environment:
      - DEBUG=0
      - DATABASE_URL=postgresql://postgres:${POSTGRES_PASSWORD}@db:5432/revolutionary_lms
      - REDIS_URL=redis://redis:6379/0
      - SECRET_KEY=${SECRET_KEY}
    deploy:
      resources:
        limits:
          memory: 8G
        reservations:
          memory: 4G

  quantum-computer:
    build:
      context: .
      dockerfile: Dockerfile
    command: python manage.py run_quantum_computer
    volumes:
      - quantum_data:/app/quantum_data
    depends_on:
      - redis
    restart: unless-stopped
    environment:
      - QUANTUM_COHERENCE=0.99
      - QUBIT_COUNT=1000
    deploy:
      resources:
        limits:
          memory: 16G
        reservations:
          memory: 8G

  neural-interface:
    build:
      context: .
      dockerfile: Dockerfile
    command: python manage.py run_neural_interface
    volumes:
      - neural_data:/app/neural_data
    depends_on:
      - redis
    restart: unless-stopped
    environment:
      - NEURAL_TRANSFER_RATE=1gbps
      - BRAIN_SYNC_ENABLED=true
    deploy:
      resources:
        limits:
          memory: 12G
        reservations:
          memory: 6G

  time-machine:
    build:
      context: .
      dockerfile: Dockerfile
    command: python manage.py run_time_machine
    volumes:
      - temporal_data:/app/temporal_data
    depends_on:
      - redis
    restart: unless-stopped
    environment:
      - TEMPORAL_STABILITY=0.95
      - PARADOX_PREVENTION=true
    deploy:
      resources:
        limits:
          memory: 10G
        reservations:
          memory: 5G

  dna-storage:
    build:
      context: .
      dockerfile: Dockerfile
    command: python manage.py run_dna_storage
    volumes:
      - dna_data:/app/dna_data
    depends_on:
      - redis
    restart: unless-stopped
    environment:
      - DNA_DENSITY=petabyte_per_gram
      - SYNTHESIS_TYPE=enzymatic
    deploy:
      resources:
        limits:
          memory: 8G
        reservations:
          memory: 4G

  metaverse-server:
    build:
      context: .
      dockerfile: Dockerfile
    command: python manage.py run_metaverse_server
    volumes:
      - metaverse_data:/app/metaverse_data
    depends_on:
      - redis
    restart: unless-stopped
    environment:
      - VIRTUAL_AREA=unlimited
      - MAX_POPULATION=10000
    deploy:
      resources:
        limits:
          memory: 16G
        reservations:
          memory: 8G

  antimatter-reactor:
    build:
      context: .
      dockerfile: Dockerfile
    command: python manage.py run_antimatter_reactor
    volumes:
      - reactor_data:/app/reactor_data
    depends_on:
      - redis
    restart: unless-stopped
    environment:
      - REACTOR_TYPE=matter_antimatter_annihilation
      - POWER_OUTPUT=infinite
    deploy:
      resources:
        limits:
          memory: 20G
        reservations:
          memory: 10G

  wormhole-generator:
    build:
      context: .
      dockerfile: Dockerfile
    command: python manage.py run_wormhole_generator
    volumes:
      - wormhole_data:/app/wormhole_data
    depends_on:
      - redis
    restart: unless-stopped
    environment:
      - GENERATOR_TYPE=quantum_entanglement
      - BANDWIDTH=infinite
    deploy:
      resources:
        limits:
          memory: 12G
        reservations:
          memory: 6G

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - static_volume:/app/staticfiles
      - media_volume:/app/media
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - web
    restart: unless-stopped

volumes:
  postgres_data:
  static_volume:
  media_volume:
  quantum_data:
  neural_data:
  temporal_data:
  dna_data:
  metaverse_data:
  reactor_data:
  wormhole_data:
